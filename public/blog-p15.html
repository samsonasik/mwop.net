<!DOCTYPE html><!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8" />
    <title>Blog Entriesphly, boy, phly</title>
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <link href="/css/SkeletonCss/base.css" media="screen" rel="stylesheet" type="text/css">
<link href="/css/SkeletonCss/skeleton.css" media="screen" rel="stylesheet" type="text/css">
<link href="/css/SkeletonCss/layout.css" media="screen" rel="stylesheet" type="text/css">
<link href="/css/Application/site.css" media="screen" rel="stylesheet" type="text/css">
<link href="/images/Application/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
<link href="/css/Application/blog.css" media="screen" rel="stylesheet" type="text/css">
<link href="/blog-atom.xml" rel="alternate" type="application/atom+xml" title="Blog Entries Atom Feed">
<link href="/blog-rss.xml" rel="alternate" type="application/rss+xml" title="Blog Entries RSS Feed">
    <script type="text/javascript">
    //<!--
    dojoConfig={
    has: {
        "dojo-firebug": false
    },
    baseurl: "/js/",
    parseOnLoad: false,
    async: true,
    tlmSiblingOfDojo: false,
    packages: [
        { name: "dijit", location: "../dijit" },
        { name: "dojox", location: "../dojox" },
        { name: "Application", location: "../Application" }
    ]
};
    //-->
</script>
<script type="text/javascript" src="/js/dojo/dojo.js"></script>
<script type="text/javascript">
    //<!--
    require(["Application/blog"]);    //-->
</script>
<script type="text/javascript">
    //<!--
    require(["Application/scroll"], function(scroll) {});    //-->
</script>
    <script src="https://www.google.com/jsapi?ABQIAAAAGybdRRvLZwVUcF0dE3oVdBTO-MlgA7VGJpGqyqTOeDXlNzyZQxTGq17s-iAB0m0vwqLQ_A2dHhTg2Q"></script>
<script type="text/javascript">
    google.load('search', '1', {style: google.loader.themes.ESPRESSO});
    google.setOnLoadCallback(function(){
        new google.search.CustomSearchControl().draw('search');
    }, true);
</script>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27037983-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head>
<body>
<div class="container">
    <header class="sixteen columns">
        <div class="one-half column logo">
            <a href="/"><img src="/images/Application/logo.gif" height="37" width="37" alt="Celtic Knot" /></a>
            <span class="main_title">phly, boy, phly: matthew weier o'phinney</span>
        </div>

        <nav class="one-half column" id="menu"><ul>
            <li><a href="/">Home</a></li>
            <li><a href="/blog.html">Blog</a></li>
            <li><a href="/resume">R&eacute;sum&eacute;</a></li>
            <li><a href="/contact">Contact</a></li>
        </ul></nav>
    </header>


    <div class="sixteen columns clearfix content">
        <div class="row">
<section class="eleven columns alpha blog">
    <h2>Blog Entries</h2>

<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-09-14 10:27:56</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a><br />
<a href="/blog/tag/zend%20framework.html">zend framework</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/143-NYPHP-Zend-Framework-Presentation.html">NYPHP Zend Framework Presentation</a></h4>

    <div class="entry body"><p>
    This past Wednesday, <a href="http://www.zend.com/">Zend's</a> Chief
    Marketing Officer, <a href="http://blogs.zend.com/author/mark/">Mark de
        Visser</a>, and myself joined the <a href="http://nyphp.org/">NYPHP</a>
    group for a <a
        href="http://nyphp.org/content/calendar/view_entry.php?id=112&date=20070912">special
        event meeting</a>. Mark presented information on Zend's development
    stack and toolset (which I entirely missed, as I was still in transit), and
    I came in to give an overview of <a href="http://framework.zend.com/">Zend
        Framework</a>.
</p>

<p>
    There were some great questions, and nice discussions following the event.
    If you live in New York and do PHP for a living, and haven't attended, you
    should; if you're ever visiting the area, see if you can attend a meeting!
</p>

<p>
    <a href="/uploads/FrameworkPresentation.zip"
        title="FrameworkPresentation.zip" target="_blank">Here are the
        slides.</a> They're done using <a
        href="http://meyerweb.com/eric/tools/s5/">S5</a>, a browser-based
    slideshow system. Simply unzip and double-click on index.html to start
    viewing.
</p></div>

    <p><a href="/blog/143-NYPHP-Zend-Framework-Presentation.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-07-05 17:26:00</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a><br />
<a href="/blog/tag/pear.html">pear</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/142-File_Fortune-refactored.html">File_Fortune refactored</a></h4>

    <div class="entry body"><p>
    Over the past few evenings, I've refactored <a href="http://pear.php.net/trackback/trackback.php?id=File_Fortune">File_Fortune</a>
    to have it implement Iterator, Countable, and ArrayAccess -- basically
    allowing it to act like an array for most intents and purposes. As a result,
    I've eliminated the need for the <kbd>File_Fortune_Writer</kbd> package, and
    greatly simplified the usage.
</p>

<p>
    (Note: sure, File_Fortune may not be that big of a deal, but over 1000
    downloads in the past two years indicates <em>somebody</em> is using it.
    Plus, it powers the random quotes on the family website. :-) )
</p>

<p>
    As some examples:
</p>
<div class="example"><pre><code lang="php">
require_once 'File/Fortune.php';

// Initialize and point it to a directory of fortunes
$fortunes = new File_Fortune('/path/to/fortunedir');

// Retrieve a random fortune 
// (works with either a directory or a single fortune file)
echo $fortunes-&gt;getRandom();

// Set to a specific fortune file:
$fortunes-&gt;setFile('myfortunes');

// Loop through and print all fortunes
foreach ($fortunes as $fortune) {
    echo str_repeat('-', 72), \&quot;\n\&quot;, $fortune, \&quot;\n\n\&quot;;
}

// Hmmm.. let's change one:
$fortunes[7] = \&quot;I never really liked that fortune anyways.\&quot;;

// No need to explicitly save, as it's done during __destruct(), 
// but if you really want to:
$fortunes-&gt;save();

// Let's add a new fortune:
$fortunes-&gt;add('This is a shiny new fortune!');

// and now we'll verify it exists:
$index = count($fortunes) - 1;
echo $fortunes[$index];
</code></pre></div>

<p>
    All-in-all, it's a much better interface. Lesson learned: when porting code
    from other languages, it pays to take some time and determine if there might
    be a better API in your own.
</p>
<p>
    In upcoming releases, I hope to modify the backend to use PHP's Streams API
    instead of direct file access, and also to allow providing a list of fortune
    files explicitly. After that, I should be ready for the initial stable
    release.
</p>

<p><b>Update (2007-07-10): fixed parse error in examples</b></p></div>

    <p><a href="/blog/142-File_Fortune-refactored.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-05-20 12:23:50</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/140-Globals%2C-continued.html">Globals, continued</a></h4>

    <div class="entry body"><p>
    <b>Update:</b> Sara has pointed out a flaw in my last case. The file 'loadFileWithGlobals.php' was incorrectly loading the wrong file -- it should be loading 'withGlobals2.php' (updated now). When it does, access to 'baz2' works as it should.
</p>
<p>
    As I note to in my comment, however, I stand by my original rant: relying on globals for your applications is a bad practice, as it makes them difficult to integrate with other applications later. Developers using your application should not need to hunt down exactly when a global is first declared and explicitly push it into the global scope in order to get that application to integrate with others. Use other means, such as singletons or registries, to persist configuration within your applications.
</p>
<hr />
<p>
    In <a href="/matthew/index.php?url=archives/139-PHP-globals-for-the-OOP-developer.html">my last entry</a>, 
    I evidently greatly simplified the issue to the point that my example
    actually didn't display the behaviour I had observed. I'm going to show a
    more detailed example that shows exactly the behaviour that was causing
    issues for me.
</p>

<p>
    First off, this has specifically to do with including files from within
    functions or class methods that then call on other files that define values
    in the global scope. In the original example, I show an action controller
    method that includes the serendipity bootstrap file, which in turn loads a
    configuration file that sets a multi-dimensional array variable in the
    global scope. Without first defining the variable in the global scope, this
    method of running serendipity fails.
</p>

<p>
    Now, for the examples.
</p></div>

    <p><a href="/blog/140-Globals%2C-continued.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-05-19 09:42:48</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/139-PHP-globals-for-the-OOP-developer.html">PHP globals for the OOP developer</a></h4>

    <div class="entry body"><p>
    <b>Update:</b> I evidently simplified the issue too much, and have had several
    people rightly comment on the bogosity of the issue. However, there are still situations
    where <kbd>$GLOBALS</kbd> does not act as expected, and I outline these in
    <a href="http://weierophinney.net/matthew/archives/140-Globals,-continued.html">my next entry</a>.
</p>
<hr />
<p>
    In my <a
        href="/matthew/archives/138-Start-Writing-Embeddable-Applications.html">previous
        entry</a>, I ranted about the use of globals in popular PHP
    applications, and how they make embedding said applications difficult. I
    develop using object-oriented practices, and can honestly say I can't recall
    ever having slung a global variable around in my own code. Globals seem
    hackish to me, and as a result, trying to get applications that use them
    to behave correctly has been a challenge.
</p>

<p>
    One of the applications I had in mind was <a
        href="http://www.s9y.org">Serendipity</a>, the software that powers this
    blog. I was attempting to create a Zend Framework action controller that
    wraps my s9y instance so that I can do things such as apply ACLs from my
    website to selected entries, as well as pull the sitewide skeleton out from
    s9y so that I only have to maintain one version of it (I had one version for
    s9y, and another for my own content featured on the site (resume, contact
    form, etc.).
</p>

<p>
    I tried importing the various config files into my action method prior to
    invoking the actual s9y bootstrap, but no dice. I also tried modifying the
    s9y config files to use the notation <kbd>$GLOBALS['serendipity']</kbd>
    around the serendipity configuration variables (s9y uses a single
    multi-dimensional array for all configuration options). This didn't work,
    either; s9y functions that called <kbd>global $serendipity</kbd> were still
    getting a null value.
</p>

<p>
    So, I did a little closer reading in the manual <a
        href="http://php.net/language.variables.predefined">section on
        predefined variables</a>, I discovered something interesting in the
    description of <kbd>$GLOBALS</kbd> (emphasis mine):
</p>

<blockquote>
    Contains a reference to every variable which is <em>currently</em> available
    within the global scope of the script.
</blockquote>

<p>
    Interestingly, the section on variable scope didn't make this distinction at
    all. Basically, if the variable you reference via <kbd>$GLOBALS</kbd> does
    not already exist, assigning it <em>does nothing</em>. It doesn't even raise
    a notice. It just silently goes ahead, leaving you thinking you set a new
    global variable, but in fact, you cannot assign new globals via
    <kbd>$GLOBALS</kbd>; you can only modify <em>existing</em> variables in the
    global scope.
</p>

<p>
    So, I got around the issue by putting this in my front controller bootstrap:
</p>

<div class="example"><pre><code lang="php">
$serendipity = null;
</code></pre></div>

<p>
    After that, I was able to create a wrapper action controller for s9y very
    easily:
</p>

<div class="example"><pre><code lang="php">
/** Zend_Controller_Action */
require_once 'Zend/Controller/Action.php';

/**
 * Serendipity integration
 * 
 * @uses       Zend_Controller_Action
  */
class S9y_IndexController extends Zend_Controller_Action
{
    public function init()
    {
        // New ViewRenderer helper in ZF incubator; telling it not
        // to autorender a view script when done
        $this-&gt;_helper-&gt;viewRenderer-&gt;initView(null, null, array('noRender' =&gt; true));
    }

    public function indexAction()
    {
        global $serendipity;
        chdir($_SERVER['DOCUMENT_ROOT'] . '/path/to/s9y');
        include './index.php';
        chdir($_SERVER['DOCUMENT_ROOT']);
    }
}
</code></pre></div>

<p>
    Note that I don't do any output buffering; this is because the ZF dispatcher
    takes care of that for me. All I need to do is execute the s9y bootstrap.
</p>

<p>
    So, the lesson to learn from all this: if you need to wrap an application
    that uses globals, find out what all of them are, and declare them in the
    global namespace -- just setting them to null is enough -- in your
    application bootstrap.
</p></div>

    <p><a href="/blog/139-PHP-globals-for-the-OOP-developer.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-05-07 00:00:40</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/138-Start-Writing-Embeddable-Applications.html">Start Writing Embeddable Applications</a></h4>

    <div class="entry body"><p>
    <a href="http://killersoft.com/randomstrings/">Clay Loveless</a> wrote last
    year an article entitled <a
        href="http://killersoft.com/randomstrings/2006/06/14/stop-writing-loner-applications/">Stop
        Writing Loner Applications</a> in which he ranted about all the
    monolithic applications that act like they're the only kid on the block when
    it comes to user authentication. Basically, if you want to create a site
    that utilizes several third-party, off-the-shelf PHP apps (say, a forum, a
    blog, and a wiki), getting a shared authentication to work between them can
    be more than a little painful.
</p>
<p>
    I've hit a similar problem repeatedly the past couple months: most of these
    apps simply are not embeddable, at least not without modifying the source.
</p>
<p>
    "Why embed?" you ask. Simple: if I'm creating a site that has one or two of
    these applications, but also my (or my company's) own custom functionality,
    I may want to ensure that certain elements are present on all pages, or that
    I can control some of the content in all pages: a unified header and footer,
    ability to inject statistic tracking javascript, etc.
</p>
<p>
    The predominant attitudes are either, "Don't embed our app, embed your app
    in ours," or "Just modify the templates." Neither of these solutions is
    acceptable.
</p></div>

    <p><a href="/blog/138-Start-Writing-Embeddable-Applications.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-03-05 23:52:35</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/137-BostonPHP-Framework-Presentations.html">BostonPHP Framework Presentations</a></h4>

    <div class="entry body"><p>
    Last Wednesday evening, I had the honor of presenting Zend Framework to <a
        href="http://www.bostonphp.org/">BostonPHP</a>, as part of an ongoing
    series they're holding on PHP frameworks; Horde was also represented as part
    of the evening's fare. It was the first time I've attended a UG, so I got
    the double whammy of that and being a presenter. Oh, make it a triple whammy
    -- Boston is a 3+ hour drive from the Burlington, VT area I now call home.
</p>
<p>
    All in all, the presentations went quite well. It was particularly fun to
    see what my friend <a href="http://hagenbu.ch/">Chuck Hagenbuch</a>
    has been up to with <a href="http://horde.org/">Horde</a>; his description
    and demonstration of RDO, or "Rampage Data Objects" was very cool (I really
    like the idea of "Horde on the Rampage" -- it's a very funny image for me),
    as was his <em>working</em> demonstration of using WebDAV to pull results
    via PHP in the Mac Finder.
</p>
<p>
    A lot of people are interested in and working regularly with Zend Framework,
    at least based on the questions I was receiving. Attendees ranged from the
    "what does Zend do" category to the "We're standardizing on Zend Framework
    and use Zend products throughout our stack" category. The bulk of the
    comments I received were either of the flavor "I really like what I'm
    seeing" or wondering how mature/stable Zend_Db is. Unfortunately, at the
    time I was preparing the slides, there were many features in Zend_Db that can cause
    headaches, and I took some time to point these out; however most of these
    are soon to be history, due to the work of Bill Karwin and Simon Mundy, who
    are pushing to get a stable, usable DB abstraction layer out the door for ZF
    1.0. 
</p>
<p>
    During the joint question and answer session, I started getting some
    particularly tough, pointed questions from one member of the group. I wasn't
    getting particularly rattled, but the moderator, Seth, decided to intervene
    and introduce me to my interlocutor -- none other than Nate Abele of the
    CakePHP project. In the end, he joined Chuck and myself at the front of the
    room, and we had a nice panel discussing how the various frameworks handle
    different issues.
</p>
<p>
    If you're ever in the Boston area, check to see if BostonPHP is having a
    meeting; it's a fun group.
</p>
<p>
    <a href="/uploads/2007-02-28-FrameworkPresentation.pdf" title="2007-02-28-FrameworkPresentation.pdf" target="_blank">My slides are now available</a>;
    I've revised them slightly to fix some
    syntactical errors I noticed during the presentation, but otherwise they're
    what I presented. You may also want to check out the 
    <a href="http://www.bostonphp.org/images/mp3/bostonphp_2_28_07.mp3" target="_blank">podcast</a>.
</p></div>

    <p><a href="/blog/137-BostonPHP-Framework-Presentations.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-02-17 13:50:58</p>
    <p class="tags"><a href="/blog/tag/linux.html">linux</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/136-Back-on-Linux-Again.html">Back on Linux Again</a></h4>

    <div class="entry body"><p>
    A little over a year ago, <a href="http://weierophinney.net/matthew/archives/101-Using-Windows-XP.html">I stopped using Linux as my primary desktop</a> 
    due to the fact that a number of programs we were using were Windows
    dependent. Despite 
    <a href="http://weierophinney.net/matthew/archives/103-XP-+-Cygwin-+-coLinux-Productivity.html">getting coLinux running</a>,
    I've never been completely satisfied with the setup. I missed being able to
    paste with my middle-mouse button, and I was constantly having character
    encoding issues pasting back and forth between PuTTY and windows apps,
    couldn't access mail easily between my coLinux and Windows partitions, and
    overall felt that I was losing out on some productivity by not having a
    native linux environment as my primary OS.
</p>
<p>
    Last week, we had an infrastructure change at work, and I basically realized
    that my Windows + coLinux setup was going to get in the way of productivity
    -- and that, at this point, there were now Windows applications tying me to
    that OS. So, I decided it was time to go back to Linux.
</p></div>

    <p><a href="/blog/136-Back-on-Linux-Again.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-02-05 10:04:01</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/135-Extending-Singletons.html">Extending Singletons</a></h4>

    <div class="entry body"><p>
    This morning, I was wondering about how to extend a singleton class such
    that you could retrieve the new class when retrieving the singleton later.
    In particular, Zend_Controller_Front is a singleton, but what if I want to
    extend it later? A number of plugins in the Zend Framework, particularly
    view helpers and routing functionality, make use of the singleton; would I
    need to alter all of these later so I could make use of the new subclass?
</p>
<p>
    For instance, try the following code:
</p>
<div class="example"><pre><code lang="php">
class My_Controller_Front extends Zend_Controller_Front
{}

$front = My_Controller_Front::getInstance();
</code></pre></div>
<p>
    You'll get an instance of Zend_Controller_Front. But if you do the
    following:
</p>
<div class="example"><pre><code lang="php">
class My_Controller_Front extends Zend_Controller_Front
{
    protected static $_instance;

    public static function getInstance()
    {
        if (null === self::$_instance) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }
}

$front = My_Controller_Front::getInstance();
</code></pre></div>
<p>
    You'll now get an instance of My_Controller_Front. However, since
    <kbd>$_instance</kbd> is <em>private</em> in Zend_Controller_Front, calling
    <kbd>Zend_Controller_Front::getInstance()</kbd> will still return a
    Zend_Controller_Front instance -- not good.
</p>
<p>
    However, if I redefine <kbd>Zend_Controller_Front::$_instance</kbd> as
    <em>protected</em>, and have the following:
</p>
<div class="example"><pre><code lang="php">
class My_Controller_Front extends Zend_Controller_Front
{
    public static function getInstance()
    {
        if (null === self::$_instance) {
            self::$_instance = new self();
        }

        return self::$_instance;
    }
}

$front = My_Controller_Front::getInstance();
</code></pre></div>
<p>
    Then the any time I call <kbd>getInstance()</kbd> on either
    My_Controller_Front or Zend_Controller_Front, I get a My_Controller_Front
    instance!
</p>
<p>
    So, the takeaway is: if you think a singleton object could ever benefit from
    extension, define the static property holding the instance as protected, and
    then, in any extending class, override the method retrieving the instance.
</p></div>

    <p><a href="/blog/135-Extending-Singletons.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-01-31 14:20:00</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a><br />
<a href="/blog/tag/vim.html">vim</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/134-exuberant-ctags-with-PHP-in-Vim.html">exuberant ctags with PHP in Vim</a></h4>

    <div class="entry body"><p>
    One reason I've heard PHP developers use for adopting an IDE when developing
    is the ability to click on a class or function name and jump to the
    declaration. Sounds like magic, and it's definitely something I've desired.
</p>
<p>
    One way I get around it is by adopting PEAR coding standards for naming my
    classes. Since they define a one-to-one mapping of class name to the file
    system (substitute the underscore character ('_') with the directory
    separator), I can usually very quickly and easily open a class file,
    particularly if I start in the base directory of the project install.
</p>
<p>
    Today, however, I found <a href="http://ctags.sourceforge.net">exuberant ctags</a>,
    a library which can be used to generate an index file mapping language
    objects to source files and the line in the source file where they are
    declared. Contrary to its name, it's not just for the C language; it
    currently supports 33 different programming languages, including PHP.
</p>
<p>
    I decided to try it out on the Zend Framework core library today. At first
    run, it was pretty useful. However, it was only mapping classes, and, in
    addition, only those defined with the single word 'class' -- abstract classes
    and interfaces were entirely left out. So, I looked into the documentation
    to see if I could change the behaviour.
</p>
<p>
    And, being a Unix program, of course I could. First off, you can add
    functions to the items it indexes with a simple flag. Additionally, you can
    use POSIX regular expressions to refine what it searches.
</p>
<p>
    I whipped up the following script to create my tags index:
</p>
<div class="example"><pre><code lang="bash">
#!/bin/bash
cd /path/to/framework/library
exec ctags-exuberant -f ~/.vim/mytags/framework \
-h \&quot;.php\&quot; -R \
--exclude=\&quot;\.svn\&quot; \
--totals=yes \
--tag-relative=yes \
--PHP-kinds=+cf \
--regex-PHP='/abstract class ([^ ]*)/\1/c/' \
--regex-PHP='/interface ([^ ]*)/\1/c/' \
--regex-PHP='/(public |static |abstract |protected |private )+function ([^ (]*)/\2/f/'
</code></pre></div>
<p>
    This script creates the tag index in the file
    <kbd>$HOME/.vim/mytags/framework</kbd>. It scans for PHP files recursively
    through the tree, excluding any files found in a <kbd>.svn</kbd> directory
    (I'm using a checkout from the subversion repository). The file paths in the
    index are created relative to the tags file; this was important, because if
    this wasn't provided, vim was unable to jump to the file, as it couldn't
    find it. <kbd>--PHP-kinds=+cf</kbd> tells it to index classes and functions.
    Next, I've got three regular expressions.  The first tells it to match
    classes beginning with 'abstract class' as classes. The second tells it to
    match interfaces as classes. The last is so that PHP 5 methods, which begin
    with a visibility operator, to be matched as functions.
</p>
<p>
    Once the index file is generated (it takes less than a second), all you need
    to do in vim is tell it to load it: <kbd>:set
        tags=~/.vim/mytags/framework</kbd>. At this point, you can do all sorts
    of fun stuff. Place the cursor on a class name or method name, anywhere in
    it, and hit <kbd>Ctrl-]</kbd>, and you'll jump to the file and line of its
    declaration; <kbd>Ctrl-T</kbd> then takes you back. If you change the
    invocation to <kbd>Ctrl-W ]</kbd>, it will split the current window and open
    the declaration in the new pane. (If you're familiar with how help works
    with Vim, this should seem pretty familiar.)
</p>
<p>
    One more reason to stick with Vim for your PHP editing needs. :-)
</p></div>

    <p><a href="/blog/134-exuberant-ctags-with-PHP-in-Vim.html">Continue reading...</a></p>
</section>

</div>
<div class="row clearfix">
<aside class="two columns alpha entry meta">
    <p class="date">2007-01-31 12:36:53</p>
    <p class="tags"><a href="/blog/tag/php.html">php</a></p>
</aside>

<section class="nine columns omega">
    <h4 class="entry"><a href="/blog/133-PHP-decoding-of-Javascript-encodeURIComponent-values.html">PHP decoding of Javascript encodeURIComponent values</a></h4>

    <div class="entry body"><p>
    Recently, I was having some issues with a site that was attempting to use
    UTF-8 in order to support multiple languages. Basically, you could enter
    UTF-8 characters -- for instance, characters with umlauts -- but they
    weren't going through to the web services or database correctly. After more
    debugging, I discovered that when I turned off javascript on the site, and
    used the degradable interface to submit the form via plain old HTTP,
    everything worked fine -- which meant the issue was with how we were sending
    the data via XHR.
</p>
<p>
    We were using <a href="http://prototypejs.org">Prototype</a>, and in
    particular, POSTing data back to our site -- which meant that the UI
    designer was using <kbd>Form.serialize()</kbd> to encode the data for
    transmission.  This in turn uses the javascript function
    <kbd>encodeURIComponent()</kbd> to do its dirty work.
</p>
<p>
    I tried a ton of things in PHP to decode this to UTF-8, before stumbling on 
    <a href="http://www.garayed.com/perl/218742-how-decode-javascripts-encodeuricomponent-perl.html">a solution written in Perl.</a>
    Basically, the solution uses a regular expression to grab urlencoded hex
    values out of a string, and then does a double conversion on the value,
    first to decimal and then to a character. The PHP version looks like this:
</p>
<div class="example"><pre><code lang="php">
$value = preg_replace('/%([0-9a-f]{2})/ie', \&quot;chr(hexdec('\\1'))\&quot;, $value);
</code></pre></div>
<p>
    We have a method in our code to detect if the incoming request is via XHR.
    In that logic, once XHR is detected, I then pass <kbd>$_POST</kbd> through the
    following function:
</p>
<div class="example"><pre><code lang="php">
function utf8Urldecode($value)
{
    if (is_array($value)) {
        foreach ($key =&gt; $val) {
            $value[$key] = utf8Urldecode($val);
        }
    } else {
        $value = preg_replace('/%([0-9a-f]{2})/ie', 'chr(hexdec($1))', (string) $value);
    }

    return $value;
}
</code></pre></div>
<p>
    This casts all UTF-8 urlencoded values in the $_POST array back to UTF-8,
    and from there we can continue processing as normal.
</p>
<p>
    Man, but I can't wait until PHP 6 comes out and fixes these unicode
    issues...
</p></div>

    <p><a href="/blog/133-PHP-decoding-of-Javascript-encodeURIComponent-values.html">Continue reading...</a></p>
</section>

</div>
<div class="paginationControl">
        <a href="/blog.html" class="first">&lt;&lt; First</a> |
        <a href="/blog-p14.html"> &lt; Previous </a> |
        <a href="/blog-p11.html">11</a> |
            <a href="/blog-p12.html">12</a> |
            <a href="/blog-p13.html">13</a> |
            <a href="/blog-p14.html">14</a> |
            <span class="current">15</span> |
            <a href="/blog-p16.html">16</a> |
            <a href="/blog-p17.html">17</a> |
            <a href="/blog-p18.html">18</a> |
            <a href="/blog-p19.html">19</a> |
            <a href="/blog-p20.html">20</a> |
            <a href="/blog-p16.html"> Next &gt;</a> |
        <a href="/blog-p28.html" class="last"> Last &gt;&gt;</a>
</div>

</section>

<aside class="four columns offset-by-one omega sidebar blog">
        <div class="metadata">
        <h4>Blogroll</h4>
        <ul>
            <li><a href="http://sebastian-bergmann.de/">Sebastian Bergmann</a></li>
            <li><a href="http://blog.calevans.com/">Cal Evans</a></li>
            <li><a href="http://prematureoptimization.org/blog/">Shahar Evron</a></li>
            <li><a href="http://paul-m-jones.com/blog/">Paul M. Jones</a></li>
            <li><a href="http://karwin.blogspot.com/">Bill Karwin</a></li>
            <li><a href="http://mikenaberezny.com/">Mike Naberezny</a></li>
            <li><a href="http://fabien.potencier.org/">Fabien Potencier</a></li>
            <li><a href="http://benramsey.com/">Ben Ramsey</a></li>
            <li><a href="http://derickrethans.nl/">Derick Rethans</a></li>
            <li><a href="http://ralphschindler.com/">Ralph Schindler</a></li>
            <li><a href="http://www.zimuel.it/blog/">Enrico Zimuel</a></li>
        </ul>
    </div>

</aside>
</div>
    </div>

    <footer class="sixteen columns footer">
        <div class="column one-third alpha about">
            <h4>About</h4>
            <p>
    I'm a husband, father of two, plaything of a Basset puppy, and web 
    architect by day.
</p>

<ul class="resume">
    <li><a href="/resume">Resume</a></li>
    <li><a href="http://twitter.com/mwop">Twitter (@mwop)</a></li>
    <li><a href="http://www.linkedin.com/in/mweierophinney">LinkedIn</a></li>
    <li><a href="http://www.ohloh.net/accounts/weierophinney">OhLoh</a></li>
    <li><a href="http://resume.github.com/?weierophinney">GitHub</a></li>
</ul>

        </div>

        <div class="column one-third projects">
            <h4>Projects</h4>
            <ul class="projects">
    <li><a href="http://framework.zend.com/">Zend Framework (Project Lead)</a></li>
    <li><a href="http://www.the-pastry-box-project.net/baker/matthew-weier-ophinney/">The Pastry Box Project</a> (as a Baker)</li>
    <li><a href="http://github.com/weierophinney/phly_mustache">Phly_Mustache</a></li>
    <li><a href="http://github.com/weierophinney/phlyty">phlyty</a> (ZF2-based microframework)</li>
    <li>ZF2 Modules
    <ul>
        <li><a href="https://github.com/weierophinney/PhlyBlog">PhlyBlog</a></li>
        <li><a href="https://github.com/weierophinney/PhlyComic">PhlyComic</a></li>
        <li><a href="https://github.com/weierophinney/PhlyCommon">PhlyCommon</a></li>
        <li><a href="https://github.com/weierophinney/PhlyContact">PhlyContact</a></li>
        <li><a href="https://github.com/weierophinney/PhlyMongo">PhlyMongo</a></li>
        <li><a href="https://github.com/weierophinney/PhlyPaste">PhlyPaste</a></li>
        <li><a href="https://github.com/weierophinney/PhlyPeep">PhlyPeep</a> (demo purposes only)</li>
        <li><a href="https://github.com/weierophinney/PhlySimplePage">PhlySimplePage</a></li>
        <li><a href="https://github.com/weierophinney/SkeletonCssModule">SkeletonCssModule</a></li>
    </ul>
    </li>
    <li>Tools
    <ul>
        <li><a href="http://p.mwop.net">PhlyPaste</a> (pastebin)</li>
    </ul>
    </li>
</ul>

        </div>

        <div class="column one-third omega tags">
        <div id="search" style="width:100%;">Loading...</div>
<h4>Tag Cloud</h4>
<div class="cloud">
<ul class="Zend&#x5C;Tag&#x5C;Cloud"><li><a href="/blog/tag/php.html" style="font-size: 20px;">php</a></li> <li><a href="/blog/tag/zend+framework.html" style="font-size: 15px;">zend framework</a></li> <li><a href="/blog/tag/zf2.html" style="font-size: 11px;">zf2</a></li> <li><a href="/blog/tag/vim.html" style="font-size: 11px;">vim</a></li> <li><a href="/blog/tag/family.html" style="font-size: 11px;">family</a></li> <li><a href="/blog/tag/programming.html" style="font-size: 12px;">programming</a></li> <li><a href="/blog/tag/personal.html" style="font-size: 13px;">personal</a></li> <li><a href="/blog/tag/phpconcom.html" style="font-size: 10px;">phpconcom</a></li> <li><a href="/blog/tag/mvc.html" style="font-size: 11px;">mvc</a></li> <li><a href="/blog/tag/oop.html" style="font-size: 11px;">oop</a></li> <li><a href="/blog/tag/testing.html" style="font-size: 10px;">testing</a></li> <li><a href="/blog/tag/rest.html" style="font-size: 11px;">rest</a></li> <li><a href="/blog/tag/linux.html" style="font-size: 12px;">linux</a></li> <li><a href="/blog/tag/zendcon08.html" style="font-size: 11px;">zendcon08</a></li> <li><a href="/blog/tag/file_fortune.html" style="font-size: 10px;">file_fortune</a></li> <li><a href="/blog/tag/pear.html" style="font-size: 11px;">pear</a></li> <li><a href="/blog/tag/zendcon.html" style="font-size: 11px;">zendcon</a></li> <li><a href="/blog/tag/perl.html" style="font-size: 12px;">perl</a></li> <li><a href="/blog/tag/fastcgi.html" style="font-size: 10px;">fastcgi</a></li> <li><a href="/blog/tag/ubuntu.html" style="font-size: 11px;">ubuntu</a></li> <li><a href="/blog/tag/tekx.html" style="font-size: 10px;">tekx</a></li> <li><a href="/blog/tag/zendcon10.html" style="font-size: 10px;">zendcon10</a></li> <li><a href="/blog/tag/dojo.html" style="font-size: 11px;">dojo</a></li> <li><a href="/blog/tag/symfony.html" style="font-size: 11px;">symfony</a></li> <li><a href="/blog/tag/zeta+components.html" style="font-size: 10px;">zeta components</a></li> <li><a href="/blog/tag/tek09.html" style="font-size: 10px;">tek09</a></li> <li><a href="/blog/tag/spl.html" style="font-size: 11px;">spl</a></li> <li><a href="/blog/tag/subversion.html" style="font-size: 11px;">subversion</a></li> <li><a href="/blog/tag/zend+framewor.html" style="font-size: 10px;">zend framewor</a></li> <li><a href="/blog/tag/rails.html" style="font-size: 10px;">rails</a></li> <li><a href="/blog/tag/conferences.html" style="font-size: 11px;">conferences</a></li> <li><a href="/blog/tag/dpc08.html" style="font-size: 11px;">dpc08</a></li> <li><a href="/blog/tag/phpworks08.html" style="font-size: 11px;">phpworks08</a></li> <li><a href="/blog/tag/webinar.html" style="font-size: 11px;">webinar</a></li> <li><a href="/blog/tag/zencon08.html" style="font-size: 10px;">zencon08</a></li> <li><a href="/blog/tag/cw09.html" style="font-size: 11px;">cw09</a></li> <li><a href="/blog/tag/zend+server.html" style="font-size: 10px;">zend server</a></li> <li><a href="/blog/tag/dpc09.html" style="font-size: 10px;">dpc09</a></li> <li><a href="/blog/tag/sflive2010.html" style="font-size: 10px;">sflive2010</a></li> <li><a href="/blog/tag/security.html" style="font-size: 10px;">security</a></li> <li><a href="/blog/tag/wifi.html" style="font-size: 10px;">wifi</a></li> <li><a href="/blog/tag/aikido.html" style="font-size: 10px;">aikido</a></li> <li><a href="/blog/tag/books.html" style="font-size: 10px;">books</a></li> <li><a href="/blog/tag/dpc10.html" style="font-size: 10px;">dpc10</a></li> <li><a href="/blog/tag/zendcon09.html" style="font-size: 11px;">zendcon09</a></li> <li><a href="/blog/tag/git.html" style="font-size: 11px;">git</a></li> <li><a href="/blog/tag/phpwomen.html" style="font-size: 10px;">phpwomen</a></li> <li><a href="/blog/tag/virtualbox.html" style="font-size: 10px;">virtualbox</a></li> <li><a href="/blog/tag/screencast.html" style="font-size: 11px;">screencast</a></li> <li><a href="/blog/tag/advocacy.html" style="font-size: 10px;">advocacy</a></li> <li><a href="/blog/tag/politics.html" style="font-size: 10px;">politics</a></li> <li><a href="/blog/tag/internet.html" style="font-size: 10px;">internet</a></li> <li><a href="/blog/tag/microphp.html" style="font-size: 10px;">microphp</a></li> <li><a href="/blog/tag/cloud.html" style="font-size: 10px;">cloud</a></li> <li><a href="/blog/tag/composer.html" style="font-size: 10px;">composer</a></li> <li><a href="/blog/tag/doctrine.html" style="font-size: 10px;">doctrine</a></li></ul></div>
        </div>

        <br class="clear"/>

        <div class="copyright">
            Unless otherwise noted, &#169; 2004 - 2012, Matthew Weier O'Phinney
        </div>
    </footer>
</div>
</body>
</html>
