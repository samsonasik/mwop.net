<!DOCTYPE html><!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
	<meta charset="utf-8" />
    <title>Testing Zend Framework MVC Applications :: phly, boy, phly</title>
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <link href="/css/SkeletonCss/base.css" media="screen" rel="stylesheet" type="text/css" >
<link href="/css/SkeletonCss/skeleton.css" media="screen" rel="stylesheet" type="text/css" >
<link href="/css/SkeletonCss/layout.css" media="screen" rel="stylesheet" type="text/css" >
<link href="/css/Application/site.css" media="screen" rel="stylesheet" type="text/css" >
<link href="/images/Application/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" >
<link href="/css/Application/blog.css" media="screen" rel="stylesheet" type="text/css" >
<link href="/blog-atom.xml" rel="alternate" type="application/atom+xml" title="phly, boy, phly Atom Feed" >
<link href="/blog-rss.xml" rel="alternate" type="application/rss+xml" title="phly, boy, phly RSS Feed" >
    <script type="text/javascript">
    //<!--
    dojoConfig={
    has: {
        "dojo-firebug": false
    },
    baseurl: "/js/",
    parseOnLoad: false,
    async: true,
    tlmSiblingOfDojo: false,
    packages: [
        { name: "dijit", location: "../dijit" },
        { name: "dojox", location: "../dojox" },
        { name: "Application", location: "../Application" }
    ]
};
    //-->
</script>
<script type="text/javascript" src="/js/dojo/dojo.js"></script>
<script type="text/javascript">
    //<!--
    require(["Application/blog"]);    //-->
</script>
<script type="text/javascript">
    //<!--
    require(["Application/scroll"], function(scroll) {});    //-->
</script>
    <script src="https://www.google.com/jsapi?ABQIAAAAGybdRRvLZwVUcF0dE3oVdBTO-MlgA7VGJpGqyqTOeDXlNzyZQxTGq17s-iAB0m0vwqLQ_A2dHhTg2Q"></script>
<script type="text/javascript">
    google.load('search', '1', {style: google.loader.themes.ESPRESSO});
    google.setOnLoadCallback(function(){
        new google.search.CustomSearchControl().draw('search');
    }, true);
</script>

    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-27037983-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head>
<body>
<div class="container">
    <header class="sixteen columns">
        <div class="one-half column logo">
            <a href="/"><img src="/images/Application/logo.gif" height="37" width="37" alt="Celtic Knot" /></a>
            <span class="main_title">phly, boy, phly: matthew weier o'phinney</span>
        </div>

        <nav class="one-half column" id="menu"><ul>
            <li><a href="/">Home</a></li>
            <li><a href="/blog.html">Blog</a></li>
            <li><a href="/resume">R&eacute;sum&eacute;</a></li>
            <li><a href="/contact">Contact</a></li>
        </ul></nav>
    </header>


    <div class="sixteen columns content">
        <div class="row">
<article class="eleven columns alpha blog">
<h2>Testing Zend Framework MVC Applications</h2>
<p>
    Since I originally started hacking on the <a
    href="http://framework.zend.com/">Zend Framework</a> MVC in the fall of
    2006, I've been touting the fact that you can test ZF MVC projects by
    utilizing the Request and Response objects; indeed, this is what I actually
    did to test the Front Controller and Dispatcher. However, until recently,
    there was never an easy way to do so in your userland projects; the default
    request and response objects make it difficult to easily and quickly setup
    tests, and the methods introduced into the front controller to make it
    testable are largely undocumented. 
</p>

<p>
    So, one of my ongoing projects the past few months has been to create an
    infrastructure for functional testing of ZF projects using <a
        href="http://phpunit.de/">PHPUnit</a>. This past weekend, I made the
    final commits that make this functionality feature complete.
</p>

<p>
    The new functionality provides several facets:
</p>

<ul>
    <li>Stub test case classes for the HTTP versions of our Request and Response
        objects, containing methods for setting up the request environment
        (including setting GET, POST, and COOKIE parameters, HTTP request
        headers, etc).</li>
    <li><code>Zend_Dom_Query</code>, a class for using CSS selectors (and XPath)
        to query (X)HTML and XML documents.</li>
    <li>PHPUnit constraints that consume <code>Zend_Dom_Query</code> and the
        Response object to make their comparisons.</li>
    <li>A specialized PHPUnit test case that contains functionality for
        bootstrapping an MVC application, dispatching requests, and a variety of
        assertions that utilize the above constraints and objects.</li>
</ul><p>
    What might you want to test?
</p>

<ul>
    <li>HTTP response codes</li>
    <li>Whether or not the action resulted in a redirect, and where it
        redirected to</li>
    <li>Whether or not certain DOM artifacts are present (particularly helpful
        for ensuring that the DOM structure is correct for JS actions)</li>
    <li>Presence of specific HTTP response headers and/or their content</li>
    <li>What module, controller, and/or action was used in the last iteration of
        the dispatch loop</li>
    <li>What route was selected</li>
</ul>

<p>
    The aim is to make testing your controllers trivial and fun. Let's look at
    an example:
</p>

<div class="example"><pre><code lang="php">
class UserControllerTest extends Zend_Test_PHPUnit_ControllerTestCase
{
    public function setUp()
    {
        $this-&gt;bootstrap = array($this, 'appBootstrap');
        parent::setUp();
    }

    public function appBootstrap()
    {
        $this-&gt;frontController-&gt;registerPlugin(
            new Bugapp_Plugin_Initialize('test')
        );
    }

    public function testCallingControllerWithoutActionShouldPullFromIndexAction()
    {
        $this-&gt;dispatch('/user');
        $this-&gt;assertResponseCode(200);
        $this-&gt;assertController('user');
        $this-&gt;assertAction('index');
    }

    public function testIndexActionShouldContainLoginForm()
    {
        $this-&gt;dispatch('/user');
        $this-&gt;assertResponseCode(200);
        $this-&gt;assertSelect('form#login');
    }

    public function testValidLoginShouldInitializeAuthSessionAndRedirectToProfilePage()
    {
        $this-&gt;request
             -&gt;setMethod('POST')
             -&gt;setPost(array(
                 'username' =&gt; 'foobar',
                 'password' =&gt; 'foobar'
             ));
        $this-&gt;dispatch('/user/login');
        $this-&gt;assertTrue(Zend_Auth::getInstance()-&gt;hasIdentity());
        $this-&gt;assertRedirectTo('/user/view');
    }
}
</code></pre></div>

<p>
    You'll note that the <code>setUp()</code> method assigns a callback to the
    <code>$bootstrap</code> property. This allows the test case to call that
    callback to bootstrap the application; alternately, you can specify the path
    to a file to include that would do your bootstrapping. In the example above,
    I actually simply add a single "initialization" plugin to the front
    controller that takes care of bootstrapping my application (via the
    <code>routeStartup()</code> hook).
</p>

<p>
    I then have a few test cases. The first checks to ensure that the default
    action is called when no action is provided. The second checks to ensure
    that the login form is present on that page (by using a CSS selector to find
    a form with the id of 'login'). The third checks to see if I get a valid
    authentication session when logging in with good credentials, and that I get
    redirected to the appropriate location.
</p>

<p>
    This is, of course, just the tip of the iceberg; I've created a couple dozen
    other assertions as well.
</p>

<p>
    You can preview the functionality in the 
    <a href="http://framework.zend.com/svn/framework/standard/incubator/">Zend 
        Framework standard incubator</a>; look for
    Zend_Test_PHPUnit_ControllerTestCase in there, as well as the Zend_Test
    documentation in the documentation tree (in human-readable DocBook XML).
</p>

<p>
    For those of you who decide to start playing with this, I'd love any
    feedback I can get. The best place to do so, however, is on the fw-mvc
    mailing list; <a href="http://framework.zend.com/wiki/display/ZFDEV/Contributing+to+Zend+Framework#ContributingtoZendFramework-Subscribetotheappropriatemailinglists">instructions are on the ZF wiki</a>.
</p><div class="social-media">
<a href="https://twitter.com/share" class="twitter-share-button" data-via="weierophinney">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>

<div class="social-media">
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div class="fb-like" data-send="true" data-width="450" data-show-faces="true"></div>
</div>

<div class="social-media">
<div class="g-plusone" data-size="medium" data-annotation="inline"></div>
</div>

<!-- Place this render call where appropriate -->
<script type="text/javascript">
dojo.ready(function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
});
</script>

<div class="social-media">
<a href="http://www.reddit.com/submit" onclick="window.location = 'http://www.reddit.com/submit?url=' + encodeURIComponent(window.location); return false"> <img src="http://www.reddit.com/static/spreddit1.gif" alt="submit to reddit" border="0" /> </a>
</div>

    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_developer = 0;
        var disqus_shortname = 'phlyboyphly';
        var disqus_identifier = '182-Testing-Zend-Framework-MVC-Applications';
        var disqus_url = 'http://mwop.net/blog/182-Testing-Zend-Framework-MVC-Applications.html';
        var disqus_title = 'Testing Zend Framework MVC Applications';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a></article>

<aside class="four columns offset-by-one omega sidebar blog">
    <div class="metadata">
        <ul>
            <li>Posted on <b>2008-06-30 12:00:00</b>.</li>
            <li>Last updated on <b>2008-07-03 04:47:17</b>.</li>
        </ul>
    </div>

    <div class="metadata">
        <h4>Tags for this entry</h4>
        <p class="tags"><a href="/blog/tag/php.html">php</a><br />
<a href="/blog/tag/mvc.html">mvc</a><br />
<a href="/blog/tag/zend+framework.html">zend framework</a></p>
    </div>

        <div class="metadata">
        <h4>Blogroll</h4>
        <ul>
            <li><a href="http://sebastian-bergmann.de/">Sebastian Bergmann</a></li>
            <li><a href="http://blog.calevans.com/">Cal Evans</a></li>
            <li><a href="http://prematureoptimization.org/blog/">Shahar Evron</a></li>
            <li><a href="http://paul-m-jones.com/blog/">Paul M. Jones</a></li>
            <li><a href="http://karwin.blogspot.com/">Bill Karwin</a></li>
            <li><a href="http://mikenaberezny.com/">Mike Naberezny</a></li>
            <li><a href="http://fabien.potencier.org/">Fabien Potencier</a></li>
            <li><a href="http://benramsey.com/">Ben Ramsey</a></li>
            <li><a href="http://derickrethans.nl/">Derick Rethans</a></li>
            <li><a href="http://ralphschindler.com/">Ralph Schindler</a></li>
            <li><a href="http://www.zimuel.it/blog/">Enrico Zimuel</a></li>
        </ul>
    </div>

</aside>

    </div>

    <footer class="sixteen columns footer">
        <div class="column one-third alpha about">
            <h4>About</h4>
            <p>
    I'm a husband, father of two, plaything of a Basset puppy, and web 
    architect by day.
</p>

<ul class="resume">
    <li><a href="/resume">Resume</a></li>
    <li><a href="http://twitter.com/weierophinney">Twitter</a></li>
    <li><a href="http://www.linkedin.com/in/mweierophinney">LinkedIn</a></li>
    <li><a href="http://www.ohloh.net/accounts/weierophinney">OhLoh</a></li>
    <li><a href="http://resume.github.com/?weierophinney">GitHub</a></li>
</ul>

        </div>

        <div class="column one-third projects">
            <h4>Projects</h4>
            <ul class="projects">
    <li><a href="http://framework.zend.com/">Zend Framework (Project Lead)</a></li>
    <li><a href="http://www.the-pastry-box-project.net/baker/matthew-weier-ophinney/">The Pastry Box Project</a> (as a Baker)</li>
    <li><a href="http://github.com/weierophinney/phly_mustache">Phly_Mustache</a></li>
    <li>ZF2 Modules
    <ul>
        <li><a href="https://github.com/weierophinney/PhlyContact">PhlyContact</a></li>
        <li><a href="https://github.com/weierophinney/PhlyBlog">PhlyBlog</a></li>
        <li><a href="https://github.com/weierophinney/PhlyPeep">PhlyPeep</a> (demo purposes only)</li>
    </ul>
    </li>
</ul>

        </div>

        <div class="column one-third omega tags">
        <div id="search" style="width:100%;">Loading...</div>
<h4>Tag Cloud</h4>
<div class="cloud">
<ul class="Zend\Tag\Cloud"><li><a href="/blog/tag/php.html" style="font-size: 20px;">php</a></li> <li><a href="/blog/tag/zend+framework.html" style="font-size: 15px;">zend framework</a></li> <li><a href="/blog/tag/zf2.html" style="font-size: 11px;">zf2</a></li> <li><a href="/blog/tag/vim.html" style="font-size: 11px;">vim</a></li> <li><a href="/blog/tag/family.html" style="font-size: 11px;">family</a></li> <li><a href="/blog/tag/programming.html" style="font-size: 12px;">programming</a></li> <li><a href="/blog/tag/personal.html" style="font-size: 13px;">personal</a></li> <li><a href="/blog/tag/phpconcom.html" style="font-size: 10px;">phpconcom</a></li> <li><a href="/blog/tag/mvc.html" style="font-size: 11px;">mvc</a></li> <li><a href="/blog/tag/oop.html" style="font-size: 11px;">oop</a></li> <li><a href="/blog/tag/testing.html" style="font-size: 10px;">testing</a></li> <li><a href="/blog/tag/rest.html" style="font-size: 11px;">rest</a></li> <li><a href="/blog/tag/linux.html" style="font-size: 12px;">linux</a></li> <li><a href="/blog/tag/zendcon08.html" style="font-size: 11px;">zendcon08</a></li> <li><a href="/blog/tag/file_fortune.html" style="font-size: 10px;">file_fortune</a></li> <li><a href="/blog/tag/pear.html" style="font-size: 11px;">pear</a></li> <li><a href="/blog/tag/zendcon.html" style="font-size: 11px;">zendcon</a></li> <li><a href="/blog/tag/perl.html" style="font-size: 12px;">perl</a></li> <li><a href="/blog/tag/fastcgi.html" style="font-size: 10px;">fastcgi</a></li> <li><a href="/blog/tag/ubuntu.html" style="font-size: 11px;">ubuntu</a></li> <li><a href="/blog/tag/tekx.html" style="font-size: 10px;">tekx</a></li> <li><a href="/blog/tag/zendcon10.html" style="font-size: 10px;">zendcon10</a></li> <li><a href="/blog/tag/dojo.html" style="font-size: 11px;">dojo</a></li> <li><a href="/blog/tag/symfony.html" style="font-size: 11px;">symfony</a></li> <li><a href="/blog/tag/zeta+components.html" style="font-size: 10px;">zeta components</a></li> <li><a href="/blog/tag/tek09.html" style="font-size: 10px;">tek09</a></li> <li><a href="/blog/tag/spl.html" style="font-size: 11px;">spl</a></li> <li><a href="/blog/tag/subversion.html" style="font-size: 11px;">subversion</a></li> <li><a href="/blog/tag/zend+framewor.html" style="font-size: 10px;">zend framewor</a></li> <li><a href="/blog/tag/rails.html" style="font-size: 10px;">rails</a></li> <li><a href="/blog/tag/conferences.html" style="font-size: 11px;">conferences</a></li> <li><a href="/blog/tag/dpc08.html" style="font-size: 11px;">dpc08</a></li> <li><a href="/blog/tag/phpworks08.html" style="font-size: 11px;">phpworks08</a></li> <li><a href="/blog/tag/webinar.html" style="font-size: 11px;">webinar</a></li> <li><a href="/blog/tag/zencon08.html" style="font-size: 10px;">zencon08</a></li> <li><a href="/blog/tag/cw09.html" style="font-size: 11px;">cw09</a></li> <li><a href="/blog/tag/zend+server.html" style="font-size: 10px;">zend server</a></li> <li><a href="/blog/tag/dpc09.html" style="font-size: 10px;">dpc09</a></li> <li><a href="/blog/tag/sflive2010.html" style="font-size: 10px;">sflive2010</a></li> <li><a href="/blog/tag/security.html" style="font-size: 10px;">security</a></li> <li><a href="/blog/tag/wifi.html" style="font-size: 10px;">wifi</a></li> <li><a href="/blog/tag/aikido.html" style="font-size: 10px;">aikido</a></li> <li><a href="/blog/tag/books.html" style="font-size: 10px;">books</a></li> <li><a href="/blog/tag/dpc10.html" style="font-size: 10px;">dpc10</a></li> <li><a href="/blog/tag/zendcon09.html" style="font-size: 11px;">zendcon09</a></li> <li><a href="/blog/tag/git.html" style="font-size: 11px;">git</a></li> <li><a href="/blog/tag/phpwomen.html" style="font-size: 10px;">phpwomen</a></li> <li><a href="/blog/tag/virtualbox.html" style="font-size: 10px;">virtualbox</a></li> <li><a href="/blog/tag/screencast.html" style="font-size: 11px;">screencast</a></li> <li><a href="/blog/tag/advocacy.html" style="font-size: 10px;">advocacy</a></li> <li><a href="/blog/tag/politics.html" style="font-size: 10px;">politics</a></li> <li><a href="/blog/tag/internet.html" style="font-size: 10px;">internet</a></li> <li><a href="/blog/tag/microphp.html" style="font-size: 10px;">microphp</a></li> <li><a href="/blog/tag/doctrine.html" style="font-size: 10px;">doctrine</a></li></ul></div>
        </div>

        <br class="clear"/>

        <div class="copyright">
            Unless otherwise noted, &#169; 2004 - 2012, Matthew Weier O'Phinney
        </div>
    </footer>
</div>
</body>
</html>
